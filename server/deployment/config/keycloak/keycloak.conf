# /server/deployment/config/keycloak/keycloak.conf

# Server
hostname=auth.we4bee.network
http-enabled=false
https-enabled=true
https-port=8443
https-key-store-file=/opt/keycloak/conf/keystore.p12
https-key-store-password=${KC_KEYSTORE_PASSWORD}
proxy=edge

# Database
db=postgres
db-url=jdbc:postgresql://postgres_keycloak:5432/keycloak
db-username=${KC_DB_USERNAME}
db-password=${KC_DB_PASSWORD}
db-pool-initial-size=10
db-pool-min-size=10
db-pool-max-size=100

# Features
features=token-exchange,admin-fine-grained-authz,authorization
features-disabled=account-linking,docker,impersonation,scripts

# Cache
cache=ispn
cache-stack=kubernetes

# Metrics & Health
health-enabled=true
metrics-enabled=true

# Logging
log=console,file
log-console-color=true
log-console-format=%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c] (%t) %s%e%n
log-file=/opt/keycloak/log/keycloak.log
log-level=INFO

# HTTP
http-relative-path=/auth
http-max-connections=100

# Theme
theme-static-max-age=2592000
theme-cache-themes=true
theme-cache-templates=true

# JWT/Token
spi-token-security-policy-hmac-algorithm=HS512
spi-token-security-policy-hmac-key-size=512

# Sessions
spi-sticky-session-encoder-infinispan-should-attach-route=true
spi-sticky-session-encoder-infinispan-routes-cache-name=routes

# OAuth2/OIDC
oauth2-device-code-lifespan=600
oauth2-device-polling-interval=5